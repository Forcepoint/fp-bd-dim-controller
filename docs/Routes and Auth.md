# Controller Routes and Auth
### / - Root
* The only endpoint on this route is `/login`
* All endpoints on this route will be unauthenticated
* Default headers for every route are added through this router. 
 
### /ingress - Push from External
* The endpoints on this route are ones that require no JWT or internal auth (ingress modules)
* This may be utilised by setting the endpoint as `secure = false` in the metadata for the module
* All modules utilising this must provide:
	* A method of auth that terminates in that module
	* A URL with a token query param in its config info that allows external services to push data
  
### /internal - Module to Controller
* The endpoints on this route are the internal ones used by the modules to communicate with the controller.
* These endpoints use an internal token for auth, this is generated by the controller on startup and can be retrieved by querying `/api/keys`. This token should be passed as an environment variable (`INTERNAL_TOKEN`) in the modules docker-compose before bringing it up.
* These endpoints include:
	*  `/register` (controller endpoint)
	*  `/queue` (controller endpoint)
	*  `/update` (controller endpoint)
	*  `/logevent` (controller endpoint). 
	
### /api - External to Controller/Module
* The endpoints on this route are the ones used by the UI module to communicate to the controller and to communicate to the modules for their config, etc.
* These endpoints use a JWT for auth, this is returned upon a succesful login using the `/login` endpoint. The JWT should be added to the `x-access-token` header for each request to the `/api` route.
* These endpoints include:
	* `/export` - Controller endpoint to export the safe list or block list.
	* `/keys` - Controller endpoint to retrieve the registration key generated on first start.
	* `/health` - Controller endpoint to retrieve the health of the controller and the MariaDB instance.
	* `/stats` - Controller endpoint to see statistics about the lists and sources.
	* `/logs` - Controller endpoint to retrieve logs created by the controller and modules, paged.
	* `/modules` - Controller endpoint to retrieve information about connected modules and their health.
	* `/user` - Controller endpoint to allow for creation of new users.
	* `/elements` - Controller endpoint to retrieve all items in the safe/block lists, paged.
* Module endpoints can also use this route, but will have their inbound route postfixed to `/api`, for example: If we have a module with an inbound route of `/fpsmc` and we want to hit the `/config` endpoint of that module, the full path will be `/api/fpsmc/config`.
* Some of the default module endpoints include:
	* `/config` - Module endpoint that returns JSON that allows the UI module to create the config page dynamically.
	* `/health` - Module endpoint that the controller can hit to retrieve the health of a module.
	* `/run` - Module endpoint that triggers the behaviour of the module, i.e. push data to a consumer.
	* `/icon` - Module endpoint that returns a PNG image 200x200 to display in the UI.

